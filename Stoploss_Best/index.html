<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Pro Trading Calculator</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        :root {
            --primary: #2962ff;
            --primary-dark: #0039cb;
            --secondary: #ff6d00;
            --success: #00c853;
            --danger: #ff1744;
            --warning: #ffab00;
            --dark: #121212;
            --dark-card: #1e1e1e;
            --dark-text: #f5f5f5;
            --light: #f5f7fa;
            --light-card: #ffffff;
            --light-text: #263238;
            --border: #e0e0e0;
            --shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
        }

        body {
            background: linear-gradient(135deg, #1a237e, #311b92);
            color: var(--light-text);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
            transition: background 0.4s ease;
        }

        body.dark {
            background: linear-gradient(135deg, #0d1b2a, #1b263b);
            color: var(--dark-text);
        }

        .container {
            max-width: 1400px;
            width: 100%;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 25px;
        }

        @media (max-width: 768px) {
            .container {
                grid-template-columns: 1fr;
            }
        }

        .card {
            background: var(--light-card);
            border-radius: 20px;
            box-shadow: var(--shadow);
            padding: 30px;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        body.dark .card {
            background: var(--dark-card);
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
        }

        .card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 5px;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 1px solid var(--border);
        }

        body.dark .card-header {
            border-bottom: 1px solid #333;
        }

        .card-title {
            font-size: 24px;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .toggle-container {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 14px;
            font-weight: 500;
        }

        .toggle-switch {
            position: relative;
            width: 50px;
            height: 24px;
            background: #ddd;
            border-radius: 12px;
            cursor: pointer;
            transition: background 0.3s;
        }

        .toggle-switch::before {
            content: '';
            position: absolute;
            top: 2px;
            left: 2px;
            width: 20px;
            height: 20px;
            background: white;
            border-radius: 50%;
            transition: transform 0.3s;
        }

        body.dark .toggle-switch {
            background: #555;
        }

        body.dark .toggle-switch::before {
            transform: translateX(26px);
        }

        .input-group {
            margin-bottom: 20px;
        }

        .input-label {
            display: flex;
            align-items: center;
            gap: 10px;
            font-weight: 600;
            margin-bottom: 8px;
            font-size: 14px;
            color: var(--light-text);
        }

        body.dark .input-label {
            color: var(--dark-text);
        }

        .input-field {
            width: 100%;
            padding: 14px 15px;
            border: 1px solid var(--border);
            border-radius: 10px;
            font-size: 16px;
            background: rgba(245, 247, 250, 0.8);
            transition: all 0.3s;
        }

        body.dark .input-field {
            background: #2a2a2a;
            border-color: #444;
            color: var(--dark-text);
        }

        .input-field:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(41, 98, 255, 0.2);
        }

        .slider-container {
            margin-top: 5px;
        }

        .slider {
            width: 100%;
            height: 6px;
            appearance: none;
            -webkit-appearance: none;
            background: #e0e0e0;
            border-radius: 3px;
            outline: none;
        }

        body.dark .slider {
            background: #444;
        }

        .slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 20px;
            height: 20px;
            background: var(--primary);
            border-radius: 50%;
            cursor: pointer;
            transition: all 0.3s;
        }

        .slider::-webkit-slider-thumb:hover {
            transform: scale(1.2);
            background: var(--primary-dark);
        }

        .row {
            display: flex;
            gap: 15px;
            margin-bottom: 15px;
        }

        .row>div {
            flex: 1;
        }

        .position-toggle {
            display: flex;
            gap: 15px;
            margin: 20px 0;
        }

        .position-btn {
            flex: 1;
            padding: 14px;
            font-weight: 600;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            transition: all 0.3s;
            background: #f0f4ff;
            color: var(--primary);
        }

        body.dark .position-btn {
            background: #2a2a2a;
        }

        .position-btn.active {
            background: var(--primary);
            color: white;
        }

        .position-btn.short.active {
            background: var(--danger);
        }

        .result-container {
            background: linear-gradient(135deg, #2962ff, #0039cb);
            border-radius: 15px;
            padding: 20px;
            color: white;
            margin-top: 20px;
            box-shadow: 0 4px 15px rgba(41, 98, 255, 0.3);
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        body.dark .result-container {
            background: linear-gradient(135deg, #1e3a8a, #0d2b6b);
        }

        .result-item {
            text-align: center;
        }

        .result-label {
            font-size: 14px;
            margin-bottom: 5px;
            opacity: 0.9;
        }

        .result-value {
            font-size: 24px;
            font-weight: 700;
        }

        .btn-group {
            display: flex;
            gap: 15px;
            margin-top: 20px;
        }

        .btn {
            flex: 1;
            padding: 14px;
            font-weight: 600;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .btn-primary {
            background: var(--primary);
            color: white;
        }

        .btn-primary:hover {
            background: var(--primary-dark);
            transform: translateY(-2px);
        }

        .btn-secondary {
            background: #f0f4ff;
            color: var(--primary);
        }

        body.dark .btn-secondary {
            background: #2a2a2a;
            color: var(--dark-text);
        }

        .btn-secondary:hover {
            background: #e0e8ff;
            transform: translateY(-2px);
        }

        body.dark .btn-secondary:hover {
            background: #333;
        }

        .btn-success {
            background: var(--success);
            color: white;
        }

        .btn-success:hover {
            background: #009624;
            transform: translateY(-2px);
        }

        .btn-danger {
            background: var(--danger);
            color: white;
        }

        .btn-danger:hover {
            background: #d50000;
            transform: translateY(-2px);
        }

        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .tab {
            flex: 1;
            padding: 10px;
            text-align: center;
            background: #f0f4ff;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
        }

        body.dark .tab {
            background: #2a2a2a;
        }

        .tab.active {
            background: var(--primary);
            color: white;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .profit-loss-container {
            background: linear-gradient(135deg, #4caf50, #2e7d32);
            border-radius: 15px;
            padding: 20px;
            color: white;
            margin-top: 20px;
            box-shadow: 0 4px 15px rgba(76, 175, 80, 0.3);
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        body.dark .profit-loss-container {
            background: linear-gradient(135deg, #2e7d32, #1b5e20);
        }

        .history-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            font-size: 12px;
        }

        .history-table th,
        .history-table td {
            padding: 8px;
            text-align: left;
            border-bottom: 1px solid var(--border);
            white-space: nowrap;
        }

        body.dark .history-table th,
        body.dark .history-table td {
            border-bottom: 1px solid #444;
        }

        .history-table th {
            background: rgba(41, 98, 255, 0.1);
            font-weight: 600;
            font-size: 11px;
        }

        body.dark .history-table th {
            background: rgba(41, 98, 255, 0.2);
        }

        .history-table tr:hover {
            background: rgba(41, 98, 255, 0.05);
        }

        body.dark .history-table tr:hover {
            background: rgba(41, 98, 255, 0.1);
        }

        .profit {
            color: var(--success);
        }

        .loss {
            color: var(--danger);
        }

        .history-table-container {
            overflow-x: auto;
            max-width: 100%;
        }

        .history-actions {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }

        .logo {
            text-align: center;
            margin-bottom: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
            grid-column: 1 / -1;
        }

        .logo h1 {
            font-size: 32px;
            font-weight: 800;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
            letter-spacing: -0.5px;
        }

        .logo-icon {
            font-size: 40px;
            color: var(--secondary);
        }

        .calculator-icon {
            font-size: 24px;
            color: var(--primary);
        }

        .tooltip {
            position: relative;
            display: inline-block;
        }

        .info-icon {
            display: inline-flex;
            justify-content: center;
            align-items: center;
            width: 20px;
            height: 20px;
            background: var(--primary);
            color: white;
            border-radius: 50%;
            font-size: 12px;
            cursor: help;
            margin-left: 5px;
        }

        .tooltip .tooltip-text {
            visibility: hidden;
            width: 200px;
            background: rgba(0, 0, 0, 0.8);
            color: #fff;
            text-align: center;
            border-radius: 6px;
            padding: 10px;
            position: absolute;
            z-index: 1;
            bottom: 125%;
            left: 50%;
            transform: translateX(-50%);
            opacity: 0;
            transition: opacity 0.3s;
            font-size: 12px;
            font-weight: normal;
        }

        .tooltip:hover .tooltip-text {
            visibility: visible;
            opacity: 1;
        }

        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            z-index: 5.88;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background: var(--light-card);
            border-radius: 15px;
            padding: 30px;
            max-width: 500px;
            width: 90%;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            position: relative;
        }

        body.dark .modal-content {
            background: var(--dark-card);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .modal-title {
            font-size: 24px;
            font-weight: 700;
            color: var(--primary);
        }

        .close-modal {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #999;
            transition: all 0.3s;
        }

        .close-modal:hover {
            color: var(--danger);
        }

        .modal-body {
            margin-bottom: 25px;
            line-height: 1.6;
        }

        .modal-footer {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
        }

        .outcome-buttons {
            display: flex;
            gap: 15px;
            margin: 20px 0;
        }

        .outcome-btn {
            flex: 1;
            padding: 15px;
            font-weight: 600;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            opacity: 0.6;
        }

        .outcome-btn.selected {
            opacity: 1;
            transform: scale(1.05);
        }

        .outcome-btn.win {
            background: var(--success);
            color: white;
        }

        .outcome-btn.loss {
            background: var(--danger);
            color: white;
        }

        .outcome-btn.pending {
            background: var(--warning);
            color: white;
        }

        .outcome-btn:hover {
            opacity: 1;
            transform: translateY(-2px);
        }

        .outcome-icon {
            display: inline-block;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            text-align: center;
            line-height: 20px;
            margin-right: 5px;
            font-size: 10px;
        }

        .outcome-win {
            background: var(--success);
            color: white;
        }

        .outcome-loss {
            background: var(--danger);
            color: white;
        }

        .outcome-pending {
            background: var(--warning);
            color: white;
        }

        .mark-outcome-btn {
            padding: 4px 8px;
            font-size: 12px;
            border-radius: 4px;
            border: none;
            background: var(--warning);
            color: white;
            cursor: pointer;
            transition: all 0.3s;
        }

        .mark-outcome-btn:hover {
            opacity: 0.8;
            transform: translateY(-1px);
        }

        /* Notification Styles */
        .notification {
            position: fixed;
            bottom: 20px;
            right: 20px;
            padding: 12px 24px;
            border-radius: 8px;
            z-index: 10000;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            font-weight: 600;
            transition: all 0.3s ease;
            max-width: 300px;
            opacity: 0;
            transform: translateY(20px);
        }

        .notification.show {
            opacity: 1;
            transform: translateY(0);
        }

        .notification.success {
            background: var(--success);
            color: white;
        }

        .notification.error {
            background: var(--danger);
            color: white;
        }

        .notification.warning {
            background: var(--warning);
            color: white;
        }

        .notification.info {
            background: var(--primary);
            color: white;
        }

        .notification i {
            margin-right: 10px;
        }

        /* Performance Analytics */
        .total-pl-container {
            background: linear-gradient(135deg, #2962ff, #0039cb);
            border-radius: 15px;
            padding: 20px;
            color: white;
            margin-bottom: 20px;
            box-shadow: 0 4px 15px rgba(41, 98, 255, 0.3);
            text-align: center;
        }

        body.dark .total-pl-container {
            background: linear-gradient(135deg, #1e3a8a, #0d2b6b);
        }

        .total-pl-label {
            font-size: 16px;
            margin-bottom: 10px;
            opacity: 0.9;
        }

        .total-pl-value {
            font-size: 36px;
            font-weight: 700;
        }

        .total-pl-value.positive {
            color: #4caf50;
        }

        .total-pl-value.negative {
            color: #f44336;
        }

        .section-title {
            font-size: 18px;
            margin: 20px 0 10px;
            padding-bottom: 5px;
            border-bottom: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        body.dark .section-title {
            border-bottom: 1px solid #444;
        }

        .edit-btn {
            background: var(--warning);
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.3s;
        }

        .edit-btn:hover {
            background: #e68900;
            transform: translateY(-1px);
        }

        .chart-container {
            height: 200px;
            margin-top: 20px;
        }

        .win-loss-container {
            display: flex;
            gap: 15px;
            margin-top: 15px;
        }

        .win-counter {
            flex: 1;
            background: rgba(76, 175, 80, 0.15);
            border-radius: 10px;
            padding: 15px;
            text-align: center;
            border: 1px solid rgba(76, 175, 80, 0.3);
        }

        .loss-counter {
            flex: 1;
            background: rgba(244, 67, 54, 0.15);
            border-radius: 10px;
            padding: 15px;
            text-align: center;
            border: 1px solid rgba(244, 67, 54, 0.3);
        }

        .win-loss-label {
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 8px;
        }

        .win-loss-value {
            font-size: 24px;
            font-weight: 700;
        }

        .currency-select {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
            align-items: center;
        }

        .currency-select select {
            flex: 1;
            padding: 14px 15px;
            border: 1px solid var(--border);
            border-radius: 10px;
            font-size: 16px;
            background: rgba(245, 247, 250, 0.8);
        }

        body.dark .currency-select select {
            background: #2a2a2a;
            border-color: #444;
            color: var(--dark-text);
        }

        .conversion-result {
            background: linear-gradient(135deg, #00c853, #009624);
            border-radius: 15px;
            padding: 20px;
            color: white;
            margin-top: 20px;
            text-align: center;
            font-weight: 700;
            font-size: 24px;
            box-shadow: 0 4px 15px rgba(0, 200, 83, 0.3);
            display: none;
        }

        body.dark .conversion-result {
            background: linear-gradient(135deg, #006400, #004d00);
        }

        .risk-container {
            background: linear-gradient(135deg, #ffab00, #ff6d00);
            border-radius: 15px;
            padding: 20px;
            color: white;
            margin-top: 20px;
            box-shadow: 0 4px 15px rgba(255, 171, 0, 0.3);
        }

        body.dark .risk-container {
            background: linear-gradient(135deg, #e65100, #bf360c);
        }

        .risk-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
        }

        .risk-value {
            font-weight: 600;
        }

        .editable-field {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 5px;
            padding: 5px 8px;
            color: inherit;
            font-size: inherit;
            width: 100%;
        }

        body.dark .editable-field {
            background: rgba(255, 255, 255, 0.05);
            border-color: rgba(255, 255, 255, 0.2);
        }

        .editable-field:focus {
            outline: none;
            border-color: var(--primary);
            background: rgba(255, 255, 255, 0.2);
        }

        .decimal-info {
            font-size: 12px;
            color: #888;
            margin-top: 4px;
            text-align: right;
        }

        /* Action buttons */
        .action-buttons {
            display: flex;
            gap: 8px;
        }

        .delete-btn {
            background-color: var(--danger);
            color: white;
            border: none;
            border-radius: 4px;
            padding: 4px 8px;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .delete-btn:hover {
            background-color: #d32f2f;
            transform: translateY(-1px);
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
        }

        .delete-btn i {
            margin-right: 3px;
        }
    </style>
</head>

<body>
    <div class="container">
        <div class="logo">
            <i class="fas fa-calculator logo-icon"></i>
            <h1>Precision Trading Calculator</h1>
        </div>

        <div class="card">
            <div class="card-header">
                <div class="card-title">
                    <i class="fas fa-chart-line calculator-icon"></i>
                    <span>Stop Loss Calculator</span>
                </div>
                <div class="toggle-container">
                    <span>Dark Mode</span>
                    <div class="toggle-switch" onclick="toggleTheme()"></div>
                </div>
            </div>

            <div class="tabs">
                <div class="tab active" onclick="switchTab('trade-calculator')">Trade Calculator</div>
                <div class="tab" onclick="switchTab('history')">Trade History</div>
            </div>

            <!-- Trade Calculator Tab -->
            <div class="tab-content active" id="trade-calculator">
                <div class="input-group">
                    <div class="input-label">
                        <i class="fas fa-coins"></i>
                        <span>Asset/Symbol</span>
                        <div class="tooltip">
                            <div class="info-icon">i</div>
                            <span class="tooltip-text">Enter the trading symbol (e.g., BTC/USD, AAPL, EUR/USD)</span>
                        </div>
                    </div>
                    <input type="text" id="assetName" class="input-field" placeholder="e.g., BTC/USD, AAPL, EUR/USD">
                </div>

                <div class="input-group">
                    <div class="input-label">
                        <i class="fas fa-tag"></i>
                        <span>Entry Price ($)</span>
                        <div class="tooltip">
                            <div class="info-icon">i</div>
                            <span class="tooltip-text">The price at which you entered the trade</span>
                        </div>
                    </div>
                    <input type="number" id="entry" class="input-field" step="any" placeholder="Enter entry price"
                        oninput="calc()">
                    <div class="decimal-info">Supports up to 10 decimal places</div>
                </div>

                <div class="row">
                    <div class="input-group">
                        <div class="input-label">
                            <i class="fas fa-wallet"></i>
                            <span>Original Amount ($)</span>
                        </div>
                        <input type="number" id="original" class="input-field" value="5.88" step="0.01"
                            oninput="updateLeverage()">
                        <div class="slider-container">
                            <input type="range" min="1" max="1000" value="5.88" step="1" class="slider"
                                id="originalSlider" oninput="updateOriginalFromSlider()">
                        </div>
                    </div>
                    <div class="input-group">
                        <div class="input-label">
                            <i class="fas fa-bolt"></i>
                            <span>Leverage (Ã—)</span>
                        </div>
                        <input type="number" id="leverageX" class="input-field" value="20" step="1" min="1" max="100"
                            oninput="updateLeverage()">
                        <div class="slider-container">
                            <input type="range" min="1" max="50" value="20" step="1" class="slider" id="leverageSlider"
                                oninput="updateLeverageFromSlider()">
                        </div>
                    </div>
                </div>

                <div class="input-group">
                    <div class="input-label">
                        <i class="fas fa-sack-dollar"></i>
                        <span>Leverage Amount ($)</span>
                    </div>
                    <input type="number" id="leverage" class="input-field" readonly>
                </div>

                <div class="input-group">
                    <div class="input-label">
                        <i class="fas fa-exclamation-triangle"></i>
                        <span>Risk ($)</span>
                        <div class="tooltip">
                            <div class="info-icon">i</div>
                            <span class="tooltip-text">The amount you're willing to risk on this trade</span>
                        </div>
                    </div>
                    <input type="number" id="risk" class="input-field" value=".592" step="0.01" oninput="calc()">
                    <div class="slider-container">
                        <input type="range" min="1" max="100" value=".592" step="1" class="slider" id="riskSlider"
                            oninput="updateRiskFromSlider()">
                    </div>
                </div>

                <div class="input-group">
                    <div class="input-label">
                        <i class="fas fa-bullseye"></i>
                        <span>Target Price ($)</span>
                        <div class="tooltip">
                            <div class="info-icon">i</div>
                            <span class="tooltip-text">Your target price for taking profits</span>
                        </div>
                    </div>
                    <input type="number" id="target" class="input-field" step="any" placeholder="Enter target price"
                        oninput="calc()">
                    <div class="decimal-info">Supports up to 10 decimal places</div>
                </div>

                <div class="position-toggle">
                    <button id="longBtn" class="position-btn active" onclick="setPosition('long')">
                        <i class="fas fa-arrow-up"></i> Long
                    </button>
                    <button id="shortBtn" class="position-btn" onclick="setPosition('short')">
                        <i class="fas fa-arrow-down"></i> Short
                    </button>
                </div>

                <div class="result-container">
                    <div class="result-item">
                        <div class="result-label">Stop Loss Value</div>
                        <div id="slValue" class="result-value">$--</div>
                    </div>
                    <div class="result-item">
                        <div class="result-label">Stop Loss Price</div>
                        <div id="slPrice" class="result-value">$--</div>
                    </div>
                </div>

                <div class="profit-loss-container">
                    <div class="result-item">
                        <div class="result-label">Potential Profit</div>
                        <div id="profitValue" class="result-value">$--</div>
                    </div>
                    <div class="result-item">
                        <div class="result-label">Risk/Reward Ratio</div>
                        <div id="rrRatio" class="result-value">--</div>
                    </div>
                </div>

                <div class="btn-group">
                    <button class="btn btn-secondary" onclick="resetCalculator()">
                        <i class="fas fa-redo"></i> Reset
                    </button>
                    <button class="btn btn-primary" onclick="showTradeSummary()">
                        <i class="fas fa-file-alt"></i> Summary
                    </button>
                    <button class="btn btn-success" onclick="saveTrade()">
                        <i class="fas fa-save"></i> Save Trade
                    </button>
                </div>
            </div>

            <!-- Trade History Tab -->
            <div class="tab-content" id="history">
                <div class="input-group">
                    <div class="input-label">
                        <i class="fas fa-filter"></i>
                        <span>Filter by Position</span>
                    </div>
                    <select id="historyFilter" class="input-field" onchange="filterHistory()">
                        <option value="all">All Trades</option>
                        <option value="long">Long Positions</option>
                        <option value="short">Short Positions</option>
                    </select>
                </div>

                <div class="history-table-container">
                    <table class="history-table">
                        <thead>
                            <tr>
                                <th>Date</th>
                                <th>Time</th>
                                <th>Asset</th>
                                <th>Position</th>
                                <th>Entry</th>
                                <th>Target</th>
                                <th>Stop Loss</th>
                                <th>Outcome</th>
                                <th>P/L</th>
                                <th>Action</th> <!-- Added Action column -->
                            </tr>
                        </thead>
                        <tbody id="historyTableBody">
                            <!-- History will be populated here -->
                        </tbody>
                    </table>
                </div>

                <div class="history-actions">
                    <button class="btn btn-secondary" onclick="clearHistory()">
                        <i class="fas fa-trash"></i> Clear History
                    </button>
                    <button class="btn btn-primary" onclick="exportHistory()">
                        <i class="fas fa-download"></i> Export CSV
                    </button>
                </div>
            </div>
        </div>

        <div class="card">
            <div class="card-header">
                <div class="card-title">
                    <i class="fas fa-exchange-alt calculator-icon"></i>
                    <span>Currency Converter</span>
                </div>
            </div>

            <div class="currency-select">
                <select id="fromCurrency" class="input-field" onchange="convertCurrency()">
                    <option value="USD" selected>USD</option>
                    <option value="EUR">EUR</option>
                    <option value="GBP">GBP</option>
                    <option value="JPY">JPY</option>
                    <option value="CAD">CAD</option>
                    <option value="AUD">AUD</option>
                    <option value="CHF">CHF</option>
                    <option value="CNY">CNY</option>
                    <option value="INR">INR</option>
                </select>

                <i class="fas fa-exchange-alt"></i>

                <select id="toCurrency" class="input-field" onchange="convertCurrency()">
                    <option value="EUR">EUR</option>
                    <option value="USD">USD</option>
                    <option value="GBP">GBP</option>
                    <option value="JPY">JPY</option>
                    <option value="CAD">CAD</option>
                    <option value="AUD">AUD</option>
                    <option value="CHF">CHF</option>
                    <option value="CNY">CNY</option>
                    <option value="INR" selected>INR</option>
                </select>
            </div>

            <div class="input-group">
                <div class="input-label">
                    <i class="fas fa-money-bill-wave"></i>
                    <span>Enter Amount</span>
                </div>
                <input type="number" id="amount" class="input-field" placeholder="e.g., 5.88"
                    oninput="convertCurrency()">
            </div>

            <div class="input-group">
                <div class="input-label">
                    <i class="fas fa-globe"></i>
                    <span id="rateLabel">Exchange Rate</span>
                </div>
                <input type="number" id="rate" class="input-field" value="85" step="0.01" oninput="convertCurrency()">
            </div>

            <div id="convertResult" class="conversion-result">
                <div id="conversionText">Enter amount to convert</div>
            </div>
        </div>

        <!-- Performance Analytics Card -->
        <div class="card">
            <div class="card-header">
                <div class="card-title">
                    <i class="fas fa-chart-pie calculator-icon"></i>
                    <span>Performance Analytics</span>
                </div>
            </div>

            <div class="total-pl-container">
                <div class="total-pl-label">Total P/L</div>
                <div id="totalPL" class="total-pl-value">$0.00</div>
            </div>

            <div class="chart-container">
                <canvas id="plChart"></canvas>
            </div>

            <div class="section-title">
                Trade Statistics
                <button class="edit-btn" onclick="openEditModal()">
                    <i class="fas fa-edit"></i> Edit
                </button>
            </div>

            <div class="row">
                <div class="input-group">
                    <div class="input-label">
                        <i class="fas fa-percentage"></i>
                        <span>Win Rate</span>
                    </div>
                    <input type="text" id="winRate" class="input-field" value="0%" readonly>
                </div>

                <div class="input-group">
                    <div class="input-label">
                        <i class="fas fa-chart-line"></i>
                        <span>Avg. Profit</span>
                    </div>
                    <input type="text" id="avgProfit" class="input-field" value="$0.00" readonly>
                </div>
            </div>

            <div class="row">
                <div class="input-group">
                    <div class="input-label">
                        <i class="fas fa-chart-bar"></i>
                        <span>Avg. Loss</span>
                    </div>
                    <input type="text" id="avgLoss" class="input-field" value="$0.00" readonly>
                </div>

                <div class="input-group">
                    <div class="input-label">
                        <i class="fas fa-balance-scale"></i>
                        <span>Total Trades</span>
                    </div>
                    <input type="text" id="totalTrades" class="input-field" value="0" readonly>
                </div>
            </div>

            <div class="win-loss-container">
                <div class="win-counter">
                    <div class="win-loss-label">Total Wins</div>
                    <div id="totalWins" class="win-loss-value">0</div>
                </div>
                <div class="loss-counter">
                    <div class="win-loss-label">Total Losses</div>
                    <div id="totalLosses" class="win-loss-value">0</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Trade Outcome Modal -->
    <div class="modal" id="tradeOutcomeModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Trade Outcome</h3>
                <button class="close-modal" onclick="closeTradeOutcomeModal()">&times;</button>
            </div>
            <div class="modal-body">
                <p>How did this trade turn out?</p>
                <div class="outcome-buttons">
                    <button class="outcome-btn win" onclick="selectOutcome('win')">
                        <i class="fas fa-check-circle"></i> Win
                    </button>
                    <button class="outcome-btn loss" onclick="selectOutcome('loss')">
                        <i class="fas fa-times-circle"></i> Loss
                    </button>
                    <button class="outcome-btn pending" onclick="selectOutcome('pending')">
                        <i class="fas fa-clock"></i> Pending
                    </button>
                </div>
                <div id="outcomeInputs" style="display: none;">
                    <div class="input-group">
                        <div class="input-label">
                            <i class="fas fa-dollar-sign"></i>
                            <span id="outcomeInputLabel">Exit Price ($)</span>
                        </div>
                        <input type="number" id="outcomePrice" class="input-field" step="any"
                            placeholder="Enter exit price">
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeTradeOutcomeModal()">Cancel</button>
                <button class="btn btn-primary" onclick="finalizeTradeOutcome()">
                    <i class="fas fa-save"></i> Save Trade
                </button>
            </div>
        </div>
    </div>

    <!-- Edit Performance Modal -->
    <div class="modal" id="editPerformanceModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Edit Performance Statistics</h3>
                <button class="close-modal" onclick="closeEditModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="input-group">
                    <div class="input-label">
                        <i class="fas fa-percentage"></i>
                        <span>Win Rate (%)</span>
                    </div>
                    <input type="number" id="editWinRate" class="editable-field" step="0.1" min="0" max="100">
                </div>

                <div class="input-group">
                    <div class="input-label">
                        <i class="fas fa-chart-line"></i>
                        <span>Average Profit ($)</span>
                    </div>
                    <input type="number" id="editAvgProfit" class="editable-field" step="0.01">
                </div>

                <div class="input-group">
                    <div class="input-label">
                        <i class="fas fa-chart-bar"></i>
                        <span>Average Loss ($)</span>
                    </div>
                    <input type="number" id="editAvgLoss" class="editable-field" step="0.01">
                </div>

                <div class="input-group">
                    <div class="input-label">
                        <i class="fas fa-trophy"></i>
                        <span>Total Wins</span>
                    </div>
                    <input type="number" id="editTotalWins" class="editable-field" min="0">
                </div>

                <div class="input-group">
                    <div class="input-label">
                        <i class="fas fa-times-circle"></i>
                        <span>Total Losses</span>
                    </div>
                    <input type="number" id="editTotalLosses" class="editable-field" min="0">
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeEditModal()">Cancel</button>
                <button class="btn btn-primary" onclick="savePerformanceEdits()">
                    <i class="fas fa-save"></i> Save Changes
                </button>
            </div>
        </div>
    </div>

    <script>
        // Global variables
        let currentTradeData = null;
        let selectedOutcome = null;

        // Initialize on page load
        document.addEventListener('DOMContentLoaded', function () {
            initializeApp();
        });

        function initializeApp() {
            // Load saved theme preference
            const savedTheme = localStorage.getItem('darkMode');
            if (savedTheme === 'true') {
                document.body.classList.add('dark');
            }

            // Initialize calculator
            updateLeverage();
            calc();

            // Load and display saved data
            loadTrades();
            updatePerformanceAnalytics();
            initializeChart();
            calculateRisk();

            // Set up currency converter
            convertCurrency();

            showNotification('Trading Calculator loaded successfully!', 'success');
        }

        // Data Management Functions
        function saveToLocalStorage(key, data) {
            try {
                localStorage.setItem(key, JSON.stringify(data));
                return true;
            } catch (error) {
                console.error('Error saving to localStorage:', error);
                showNotification('Error saving data. Storage may be full.', 'error');
                return false;
            }
        }

        function loadFromLocalStorage(key) {
            try {
                const data = localStorage.getItem(key);
                return data ? JSON.parse(data) : null;
            } catch (error) {
                console.error('Error loading from localStorage:', error);
                return null;
            }
        }

        function createTradeId() {
            return Date.now() + Math.random().toString(36).substr(2, 9);
        }

        // Calculator Functions
        function updateLeverage() {
            const original = parseFloat(document.getElementById("original").value) || 0;
            const leverageX = parseFloat(document.getElementById("leverageX").value) || 0;

            if (original > 0 && leverageX > 0) {
                const leverage = original * leverageX;
                document.getElementById("leverage").value = leverage.toFixed(2);
                calc();
            }
        }

        function updateOriginalFromSlider() {
            const value = document.getElementById("originalSlider").value;
            document.getElementById("original").value = value;
            updateLeverage();
        }

        function updateLeverageFromSlider() {
            const value = document.getElementById("leverageSlider").value;
            document.getElementById("leverageX").value = value;
            updateLeverage();
        }

        function updateRiskFromSlider() {
            const value = document.getElementById("riskSlider").value;
            document.getElementById("risk").value = value;
            calc();
        }

        function setPosition(type) {
            document.getElementById("longBtn").classList.toggle("active", type === "long");
            document.getElementById("shortBtn").classList.toggle("active", type === "short");
            calc();
        }

        function calc() {
            const entry = parseFloat(document.getElementById("entry").value) || 0;
            const leverage = parseFloat(document.getElementById("leverage").value) || 0;
            const risk = parseFloat(document.getElementById("risk").value) || 0;
            const target = parseFloat(document.getElementById("target").value) || 0;
            const isLong = document.getElementById("longBtn").classList.contains("active");

            if (entry <= 0 || leverage <= 0 || risk <= 0) {
                document.getElementById("slValue").textContent = "$--";
                document.getElementById("slPrice").textContent = "$--";
                document.getElementById("profitValue").textContent = "$--";
                document.getElementById("rrRatio").textContent = "--";
                return;
            }

            // Calculate stop loss
            const slValue = (entry * risk) / leverage;
            const slPrice = isLong ? (entry - slValue) : (entry + slValue);

            // Calculate profit and risk/reward ratio
            let profitValue = 0;
            let rrRatio = "--";

            if (target > 0) {
                const priceDiff = Math.abs(target - entry);
                profitValue = (priceDiff * leverage) / entry;

                if ((isLong && target > entry) || (!isLong && target < entry)) {
                    rrRatio = (profitValue / risk).toFixed(2) + ":1";
                } else {
                    profitValue = 0;
                    rrRatio = "--";
                }
            }

            // Display with 10 decimal places for stop loss values
            document.getElementById("slValue").textContent = `$${slValue.toFixed(10)}`;
            document.getElementById("slPrice").textContent = `$${slPrice.toFixed(10)}`;
            document.getElementById("profitValue").textContent = `$${profitValue.toFixed(2)}`;
            document.getElementById("rrRatio").textContent = rrRatio;
        }

        function resetCalculator() {
            document.getElementById("assetName").value = "";
            document.getElementById("entry").value = "";
            document.getElementById("original").value = "5.88";
            document.getElementById("originalSlider").value = "5.88";
            document.getElementById("leverageX").value = "20";
            document.getElementById("leverageSlider").value = "20";
            document.getElementById("risk").value = ".592";
            document.getElementById("riskSlider").value = ".592";
            document.getElementById("target").value = "";
            document.getElementById("longBtn").classList.add("active");
            document.getElementById("shortBtn").classList.remove("active");

            updateLeverage();
            calc();
            showNotification('Calculator reset successfully!', 'info');
        }

        // Trade Management Functions
        function saveTrade() {
            try {
                // Validate inputs
                const assetName = document.getElementById("assetName").value.trim();
                const entry = parseFloat(document.getElementById("entry").value);
                const target = parseFloat(document.getElementById("target").value) || 0;
                const slPriceText = document.getElementById("slPrice").textContent.replace('$', '');
                const slPrice = parseFloat(slPriceText);
                const position = document.getElementById("longBtn").classList.contains("active") ? "Long" : "Short";
                const leverage = parseFloat(document.getElementById("leverage").value);
                const risk = parseFloat(document.getElementById("risk").value);
                const originalAmount = parseFloat(document.getElementById("original").value);
                const leverageX = parseFloat(document.getElementById("leverageX").value);

                // Validation
                if (!assetName) {
                    showNotification("Please enter an asset/symbol name", "error");
                    return;
                }
                if (!entry || entry <= 0) {
                    showNotification("Please enter a valid entry price", "error");
                    return;
                }
                if (!leverage || leverage <= 0) {
                    showNotification("Please calculate leverage amount first", "error");
                    return;
                }
                if (!risk || risk <= 0) {
                    showNotification("Please enter a valid risk amount", "error");
                    return;
                }
                if (!slPrice || slPrice <= 0) {
                    showNotification("Please calculate stop loss first", "error");
                    return;
                }

                // Create trade data
                currentTradeData = {
                    id: createTradeId(),
                    date: new Date().toLocaleDateString(),
                    time: new Date().toLocaleTimeString(),
                    asset: assetName,
                    position: position,
                    entry: entry,
                    target: target,
                    stopLoss: slPrice,
                    leverage: leverage,
                    risk: risk,
                    originalAmount: originalAmount,
                    leverageX: leverageX,
                    outcome: null,
                    profit: 0,
                    exitPrice: null
                };

                // Show outcome modal
                document.getElementById('tradeOutcomeModal').style.display = 'flex';
                selectedOutcome = null;

                // Reset modal state
                document.getElementById('outcomeInputs').style.display = 'none';
                document.getElementById('outcomePrice').value = '';

                // Reset button states
                document.querySelectorAll('.outcome-btn').forEach(btn => {
                    btn.classList.remove('selected');
                });

            } catch (error) {
                console.error("Error in saveTrade:", error);
                showNotification("Error preparing trade data. Please try again.", "error");
            }
        }

        function selectOutcome(outcome) {
            selectedOutcome = outcome;

            // Update button states
            document.querySelectorAll('.outcome-btn').forEach(btn => {
                btn.classList.remove('selected');
            });
            event.target.classList.add('selected');

            // Show/hide price input based on outcome
            if (outcome === 'win' || outcome === 'loss') {
                document.getElementById('outcomeInputs').style.display = 'block';
                document.getElementById('outcomeInputLabel').textContent =
                    outcome === 'win' ? 'Exit Price ($)' : 'Exit Price ($)';
                document.getElementById('outcomePrice').placeholder = 'Enter exit price';
            } else {
                document.getElementById('outcomeInputs').style.display = 'none';
            }
        }

        function finalizeTradeOutcome() {
            try {
                if (!selectedOutcome) {
                    showNotification('Please select a trade outcome', 'error');
                    return;
                }

                if (!currentTradeData) {
                    showNotification('Trade data not found', 'error');
                    return;
                }

                let finalProfit = 0;
                let exitPrice = null;

                if (selectedOutcome === 'win' || selectedOutcome === 'loss') {
                    exitPrice = parseFloat(document.getElementById('outcomePrice').value);
                    if (!exitPrice || exitPrice <= 0) {
                        showNotification('Please enter a valid exit price', 'error');
                        return;
                    }

                    // Calculate profit/loss
                    const entry = currentTradeData.entry;
                    const originalAmount = currentTradeData.originalAmount;
                    const leverageX = currentTradeData.leverageX;
                    const isLong = currentTradeData.position === 'Long';

                    const priceDiff = isLong ? (exitPrice - entry) : (entry - exitPrice);
                    const percentageChange = priceDiff / entry;
                    finalProfit = originalAmount * percentageChange * leverageX;

                    // Ensure correct sign for losses
                    if (selectedOutcome === 'loss' && finalProfit > 0) {
                        finalProfit = -Math.abs(finalProfit);
                    }
                    // Ensure correct sign for wins
                    if (selectedOutcome === 'win' && finalProfit < 0) {
                        finalProfit = Math.abs(finalProfit);
                    }
                }

                // Update trade data
                currentTradeData.outcome = selectedOutcome;
                currentTradeData.profit = finalProfit;
                currentTradeData.exitPrice = exitPrice;

                // Save to localStorage
                const trades = loadFromLocalStorage('trades') || [];
                trades.push(currentTradeData);

                if (saveToLocalStorage('trades', trades)) {
                    // Update total P/L if trade is completed
                    if (selectedOutcome !== 'pending') {
                        updateTotalPL(finalProfit);
                    }

                    // Update display
                    loadTrades();
                    updatePerformanceAnalytics();
                    closeTradeOutcomeModal();

                    showNotification("Trade saved successfully!", "success");
                } else {
                    showNotification("Error saving trade. Please try again.", "error");
                }

            } catch (error) {
                console.error("Error in finalizeTradeOutcome:", error);
                showNotification("Error saving trade. Please try again.", "error");
            }
        }

        function closeTradeOutcomeModal() {
            document.getElementById('tradeOutcomeModal').style.display = 'none';
            currentTradeData = null;
            selectedOutcome = null;
        }

        // History Management Functions
        function loadTrades() {
            const trades = loadFromLocalStorage('trades') || [];
            renderHistory(trades);
        }

        function renderHistory(trades = null) {
            try {
                if (!trades) {
                    trades = loadFromLocalStorage('trades') || [];
                }

                const filter = document.getElementById("historyFilter").value;
                const tableBody = document.getElementById("historyTableBody");

                // Clear table
                tableBody.innerHTML = "";

                // Filter trades
                let filteredTrades = trades;
                if (filter !== "all") {
                    filteredTrades = trades.filter(trade =>
                        trade.position.toLowerCase() === filter
                    );
                }

                // Sort by date (newest first)
                filteredTrades.sort((a, b) => new Date(b.date) - new Date(a.date));

                // Render trades
                if (filteredTrades.length === 0) {
                    tableBody.innerHTML = `<tr><td colspan="10" style="text-align: center; padding: 20px;">No trades recorded yet</td></tr>`;
                    return;
                }

                filteredTrades.forEach(trade => {
                    const row = document.createElement("tr");

                    // Format outcome
                    let outcomeHtml = '';
                    let profitHtml = '';

                    if (trade.outcome === 'win') {
                        outcomeHtml = '<span class="outcome-icon outcome-win"><i class="fas fa-check"></i></span> Win';
                        profitHtml = `<span class="profit">+$${Math.abs(trade.profit).toFixed(2)}</span>`;
                    } else if (trade.outcome === 'loss') {
                        outcomeHtml = '<span class="outcome-icon outcome-loss"><i class="fas fa-times"></i></span> Loss';
                        profitHtml = `<span class="loss">-$${Math.abs(trade.profit).toFixed(2)}</span>`;
                    } else {
                        outcomeHtml = '<span class="outcome-icon outcome-pending"><i class="fas fa-clock"></i></span> Pending';
                        profitHtml = `<button class="mark-outcome-btn" onclick="updateTradeOutcome('${trade.id}')">Mark</button>`;
                    }

                    row.innerHTML = `
                        <td>${trade.date}</td>
                        <td>${trade.time || '--'}</td>
                        <td>${trade.asset}</td>
                        <td>${trade.position}</td>
                        <td>$${trade.entry.toFixed(10)}</td>
                        <td>${trade.target > 0 ? '$' + trade.target.toFixed(10) : '--'}</td>
                        <td>$${trade.stopLoss.toFixed(10)}</td>
                        <td>${outcomeHtml}</td>
                        <td>${profitHtml}</td>
                        <td class="action-buttons">
                            <button class="delete-btn" onclick="deleteTrade('${trade.id}')">
                                <i class="fas fa-trash"></i> Delete
                            </button>
                        </td>
                    `;

                    tableBody.appendChild(row);
                });

            } catch (error) {
                console.error("Error in renderHistory:", error);
                showNotification("Error loading trade history", "error");
            }
        }

        // Function to delete a trade
        function deleteTrade(tradeId) {
            if (confirm("Are you sure you want to delete this trade?")) {
                try {
                    const trades = loadFromLocalStorage('trades') || [];
                    const tradeIndex = trades.findIndex(t => t.id === tradeId);

                    if (tradeIndex !== -1) {
                        // Remove trade and update P/L if trade was completed
                        const trade = trades[tradeIndex];
                        if (trade.outcome !== 'pending') {
                            updateTotalPL(-trade.profit);
                        }

                        trades.splice(tradeIndex, 1);

                        if (saveToLocalStorage('trades', trades)) {
                            loadTrades();
                            updatePerformanceAnalytics();
                            showNotification("Trade deleted successfully!", "success");
                        } else {
                            showNotification("Error deleting trade. Please try again.", "error");
                        }
                    }
                } catch (error) {
                    console.error("Error deleting trade:", error);
                    showNotification("Error deleting trade", "error");
                }
            }
        }

        function filterHistory() {
            loadTrades();
            showNotification('History filtered successfully', 'info');
        }

        function clearHistory() {
            if (confirm("Are you sure you want to clear all trade history? This action cannot be undone.")) {
                localStorage.removeItem('trades');
                loadTrades();
                updatePerformanceAnalytics();
                showNotification("Trade history cleared successfully", "warning");
            }
        }

        function exportHistory() {
            try {
                const trades = loadFromLocalStorage('trades') || [];

                if (trades.length === 0) {
                    showNotification("No trades to export", "error");
                    return;
                }

                // Create CSV content
                let csv = "Date,Time,Asset,Position,Entry,Target,Stop Loss,Outcome,Profit/Loss\n";

                trades.forEach(trade => {
                    const outcome = trade.outcome === 'win' ? 'Win' :
                        trade.outcome === 'loss' ? 'Loss' : 'Pending';
                    const profit = trade.outcome === 'pending' ? '0' : trade.profit.toFixed(2);

                    csv += `${trade.date},${trade.time || '--'},${trade.asset},${trade.position},$${trade.entry.toFixed(10)},${trade.target > 0 ? '$' + trade.target.toFixed(10) : '--'},$${trade.stopLoss.toFixed(10)},${outcome},$${profit}\n`;
                });

                // Download CSV
                const blob = new Blob([csv], { type: 'text/csv' });
                const url = window.URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `trading_history_${new Date().toISOString().split('T')[0]}.csv`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                window.URL.revokeObjectURL(url);

                showNotification("History exported successfully!", "success");

            } catch (error) {
                console.error("Error exporting history:", error);
                showNotification("Error exporting history", "error");
            }
        }

        // Performance Analytics Functions
        function updateTotalPL(profit) {
            const currentTotal = parseFloat(localStorage.getItem('totalPL')) || 0;
            const newTotal = currentTotal + profit;
            localStorage.setItem('totalPL', newTotal.toString());

            // Update P/L history for chart
            const plHistory = loadFromLocalStorage('plHistory') || [];
            plHistory.push({
                date: new Date().toLocaleDateString(),
                profit: profit,
                total: newTotal
            });
            saveToLocalStorage('plHistory', plHistory);

            // Update display
            displayTotalPL();
            updateChart();
        }

        function displayTotalPL() {
            const totalPL = parseFloat(localStorage.getItem('totalPL')) || 0;
            const totalPLElement = document.getElementById('totalPL');

            totalPLElement.textContent = `$${totalPL.toFixed(2)}`;
            totalPLElement.className = 'total-pl-value';

            if (totalPL > 0) {
                totalPLElement.classList.add('positive');
            } else if (totalPL < 0) {
                totalPLElement.classList.add('negative');
            }
        }

        function updatePerformanceAnalytics() {
            try {
                // Load custom performance data if exists
                const customPerformance = loadFromLocalStorage('customPerformance');

                if (customPerformance) {
                    // Use custom data
                    document.getElementById('winRate').value = `${customPerformance.winRate}%`;
                    document.getElementById('avgProfit').value = `$${customPerformance.avgProfit}`;
                    document.getElementById('avgLoss').value = `$${customPerformance.avgLoss}`;
                    document.getElementById('totalTrades').value = customPerformance.totalWins + customPerformance.totalLosses;
                    document.getElementById('totalWins').textContent = customPerformance.totalWins;
                    document.getElementById('totalLosses').textContent = customPerformance.totalLosses;
                } else {
                    // Calculate from actual trades
                    const trades = loadFromLocalStorage('trades') || [];
                    const completedTrades = trades.filter(trade => trade.outcome && trade.outcome !== 'pending');

                    if (completedTrades.length === 0) {
                        document.getElementById('winRate').value = '0%';
                        document.getElementById('avgProfit').value = '$0.00';
                        document.getElementById('avgLoss').value = '$0.00';
                        document.getElementById('totalTrades').value = '0';
                        document.getElementById('totalWins').textContent = '0';
                        document.getElementById('totalLosses').textContent = '0';
                        return;
                    }

                    const winningTrades = completedTrades.filter(trade => trade.profit > 0);
                    const losingTrades = completedTrades.filter(trade => trade.profit < 0);

                    const winRate = ((winningTrades.length / completedTrades.length) * 100).toFixed(1);
                    const avgProfit = winningTrades.length > 0 ?
                        (winningTrades.reduce((sum, trade) => sum + trade.profit, 0) / winningTrades.length).toFixed(2) : '0.00';
                    const avgLoss = losingTrades.length > 0 ?
                        Math.abs(losingTrades.reduce((sum, trade) => sum + trade.profit, 0) / losingTrades.length).toFixed(2) : '0.00';

                    // Update display
                    document.getElementById('winRate').value = `${winRate}%`;
                    document.getElementById('avgProfit').value = `$${avgProfit}`;
                    document.getElementById('avgLoss').value = `$${avgLoss}`;
                    document.getElementById('totalTrades').value = completedTrades.length;
                    document.getElementById('totalWins').textContent = winningTrades.length;
                    document.getElementById('totalLosses').textContent = losingTrades.length;
                }

                // Update chart
                updateChart();

                // Update total P/L display
                displayTotalPL();

            } catch (error) {
                console.error("Error updating performance analytics:", error);
            }
        }

        function initializeChart() {
            try {
                const ctx = document.getElementById('plChart').getContext('2d');
                window.plChart = new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: ['Start'],
                        datasets: [{
                            label: 'Cumulative P/L',
                            data: [0],
                            borderColor: '#2962ff',
                            backgroundColor: 'rgba(41, 98, 255, 0.1)',
                            borderWidth: 3,
                            fill: true,
                            tension: 0.4
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            y: {
                                beginAtZero: true,
                                ticks: {
                                    callback: function (value) {
                                        return '$' + value.toFixed(2);
                                    }
                                }
                            }
                        },
                        plugins: {
                            legend: {
                                display: false
                            }
                        }
                    }
                });
            } catch (error) {
                console.error("Error initializing chart:", error);
            }
        }

        function updateChart() {
            if (!window.plChart || !window.plChart.data || !window.plChart.data.datasets) return;

            try {
                const plHistory = loadFromLocalStorage('plHistory') || [];

                if (plHistory.length === 0) {
                    window.plChart.data.labels = ['Start'];
                    window.plChart.data.datasets[0].data = [0];
                    window.plChart.update();
                    return;
                }

                const labels = ['Start'];
                const data = [0];
                let cumulative = 0;

                plHistory.forEach((entry, index) => {
                    cumulative += entry.profit;
                    labels.push(`Trade ${index + 1}`);
                    data.push(cumulative);
                });

                window.plChart.data.labels = labels;
                window.plChart.data.datasets[0].data = data;
                window.plChart.update();

            } catch (error) {
                console.error("Error updating chart:", error);
            }
        }

        function calculateRisk() {
            // This function is called to prevent the error, but doesn't need to do anything specific
            // The risk calculation is already handled in the calc() function
        }

        function updateRiskChart() {
            // This function is called to prevent the error
            // Risk chart functionality can be implemented here if needed
        }

        // Edit Performance Functions
        function openEditModal() {
            // Load current values
            const customPerformance = loadFromLocalStorage('customPerformance');

            if (customPerformance) {
                document.getElementById('editWinRate').value = customPerformance.winRate;
                document.getElementById('editAvgProfit').value = customPerformance.avgProfit;
                document.getElementById('editAvgLoss').value = customPerformance.avgLoss;
                document.getElementById('editTotalWins').value = customPerformance.totalWins;
                document.getElementById('editTotalLosses').value = customPerformance.totalLosses;
            } else {
                // Use current displayed values
                const winRate = parseFloat(document.getElementById('winRate').value.replace('%', '')) || 0;
                const avgProfit = parseFloat(document.getElementById('avgProfit').value.replace('$', '')) || 0;
                const avgLoss = parseFloat(document.getElementById('avgLoss').value.replace('$', '')) || 0;
                const totalWins = parseInt(document.getElementById('totalWins').textContent) || 0;
                const totalLosses = parseInt(document.getElementById('totalLosses').textContent) || 0;

                document.getElementById('editWinRate').value = winRate;
                document.getElementById('editAvgProfit').value = avgProfit;
                document.getElementById('editAvgLoss').value = avgLoss;
                document.getElementById('editTotalWins').value = totalWins;
                document.getElementById('editTotalLosses').value = totalLosses;
            }

            document.getElementById('editPerformanceModal').style.display = 'flex';
        }

        function closeEditModal() {
            document.getElementById('editPerformanceModal').style.display = 'none';
        }

        function savePerformanceEdits() {
            try {
                const winRate = parseFloat(document.getElementById('editWinRate').value) || 0;
                const avgProfit = parseFloat(document.getElementById('editAvgProfit').value) || 0;
                const avgLoss = parseFloat(document.getElementById('editAvgLoss').value) || 0;
                const totalWins = parseInt(document.getElementById('editTotalWins').value) || 0;
                const totalLosses = parseInt(document.getElementById('editTotalLosses').value) || 0;

                // Validate inputs
                if (winRate < 0 || winRate > 100) {
                    showNotification('Win rate must be between 0 and 100', 'error');
                    return;
                }

                if (avgLoss < 0) {
                    showNotification('Average loss cannot be negative', 'error');
                    return;
                }

                if (totalWins < 0 || totalLosses < 0) {
                    showNotification('Win/Loss counts cannot be negative', 'error');
                    return;
                }

                // Save custom performance data
                const customPerformance = {
                    winRate: winRate,
                    avgProfit: avgProfit.toFixed(2),
                    avgLoss: avgLoss.toFixed(2),
                    totalWins: totalWins,
                    totalLosses: totalLosses
                };

                if (saveToLocalStorage('customPerformance', customPerformance)) {
                    updatePerformanceAnalytics();
                    closeEditModal();
                    showNotification('Performance statistics updated successfully!', 'success');
                } else {
                    showNotification('Error saving performance data', 'error');
                }

            } catch (error) {
                console.error('Error saving performance edits:', error);
                showNotification('Error saving performance data', 'error');
            }
        }

        // Currency Converter Functions
        function convertCurrency() {
            const amount = parseFloat(document.getElementById("amount").value) || 0;
            const rate = parseFloat(document.getElementById("rate").value) || 1;
            const fromCurrency = document.getElementById("fromCurrency").value;
            const toCurrency = document.getElementById("toCurrency").value;

            // Update rate label
            document.getElementById("rateLabel").textContent = `1 ${fromCurrency} = ${rate} ${toCurrency}`;

            if (amount > 0) {
                const converted = amount * rate;
                document.getElementById("conversionText").textContent =
                    `${amount.toFixed(2)} ${fromCurrency} = ${converted.toFixed(2)} ${toCurrency}`;
                document.getElementById("convertResult").style.display = "block";
            } else {
                document.getElementById("convertResult").style.display = "none";
            }
        }

        // UI Functions
        function switchTab(tabId) {
            // Hide all tab contents
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });

            // Remove active class from all tabs
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });

            // Show selected tab content
            document.getElementById(tabId).classList.add('active');

            // Set active class on clicked tab
            event.target.classList.add('active');
        }

        function toggleTheme() {
            const body = document.body;
            body.classList.toggle("dark");
            localStorage.setItem('darkMode', body.classList.contains('dark'));
            showNotification('Theme changed successfully!', 'info');
        }

        function showTradeSummary() {
            const assetName = document.getElementById("assetName").value || "Not specified";
            const entry = document.getElementById("entry").value || "Not specified";
            const leverage = document.getElementById("leverage").value || "Not calculated";
            const risk = document.getElementById("risk").value || "Not specified";
            const position = document.getElementById("longBtn").classList.contains("active") ? "Long" : "Short";
            const slValue = document.getElementById("slValue").textContent;
            const slPrice = document.getElementById("slPrice").textContent;
            const profitValue = document.getElementById("profitValue").textContent;
            const rrRatio = document.getElementById("rrRatio").textContent;

            const summary = `Trade Summary:
Asset: ${assetName}
Position: ${position}
Entry Price: $${entry}
Leverage Amount: $${leverage}
Risk: $${risk}
Stop Loss Value: ${slValue}
Stop Loss Price: ${slPrice}
Potential Profit: ${profitValue}
Risk/Reward Ratio: ${rrRatio}`;

            alert(summary);
        }

        function showNotification(message, type = 'success') {
            try {
                const notification = document.createElement('div');
                notification.className = `notification ${type}`;

                const icons = {
                    success: 'fas fa-check-circle',
                    error: 'fas fa-exclamation-circle',
                    warning: 'fas fa-exclamation-triangle',
                    info: 'fas fa-info-circle'
                };

                notification.innerHTML = `<i class="${icons[type]}"></i> ${message}`;
                document.body.appendChild(notification);

                // Show notification
                setTimeout(() => {
                    notification.classList.add('show');
                }, 100);

                // Hide notification after 3 seconds
                setTimeout(() => {
                    notification.classList.remove('show');
                    setTimeout(() => {
                        if (notification.parentNode) {
                            notification.parentNode.removeChild(notification);
                        }
                    }, 300);
                }, 3000);

            } catch (error) {
                console.error("Error showing notification:", error);
            }
        }

        // Handle updating pending trades
        function updateTradeOutcome(tradeId) {
            const trades = loadFromLocalStorage('trades') || [];
            const trade = trades.find(t => t.id === tradeId);

            if (!trade) return;

            const outcome = prompt("Enter outcome (win/loss):");
            if (!outcome || !['win', 'loss'].includes(outcome.toLowerCase())) {
                showNotification("Invalid outcome. Please enter 'win' or 'loss'.", "error");
                return;
            }

            const exitPrice = parseFloat(prompt("Enter exit price:"));
            if (!exitPrice || exitPrice <= 0) {
                showNotification("Invalid exit price.", "error");
                return;
            }

            // Calculate profit/loss
            const entry = trade.entry;
            const originalAmount = trade.originalAmount;
            const leverageX = trade.leverageX;
            const isLong = trade.position === 'Long';

            const priceDiff = isLong ? (exitPrice - entry) : (entry - exitPrice);
            const percentageChange = priceDiff / entry;
            let profit = originalAmount * percentageChange * leverageX;

            if (outcome.toLowerCase() === 'loss' && profit > 0) {
                profit = -Math.abs(profit);
            }
            if (outcome.toLowerCase() === 'win' && profit < 0) {
                profit = Math.abs(profit);
            }

            // Update trade
            trade.outcome = outcome.toLowerCase();
            trade.profit = profit;
            trade.exitPrice = exitPrice;

            // Save updated trades
            if (saveToLocalStorage('trades', trades)) {
                updateTotalPL(profit);
                loadTrades();
                updatePerformanceAnalytics();
                showNotification("Trade outcome updated successfully!", "success");
            }
        }
    </script>
</body>

</html>